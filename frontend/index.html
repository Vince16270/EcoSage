<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EcoSage Chat</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --green:#14633f; --green-dark:#0f4e32; --green-light:#e8f6f0;
      --text:#1b1b1b;  --radius:16px;        --shadow:0 8px 18px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:"Nunito",system-ui,sans-serif;background:var(--green-light);color:var(--text);}body{display:flex}

    /* Sidebar */
    #sidebar{position:fixed;left:-280px;top:0;height:100%;width:280px;background:#fff;
      box-shadow:4px 0 12px rgba(0,0,0,.08);display:flex;flex-direction:column;
      padding:24px 20px 70px;transition:left .35s;z-index:200}
    #sidebar.open{left:0}
    #sidebar h2{font-size:1.2rem;font-weight:700;margin-bottom:18px}
    .session{padding:11px 14px;border-radius:var(--radius);background:#f4fbf7;margin-bottom:11px;font-size:.9rem;cursor:pointer;transition:background .25s}
    .session:hover{background:#dff0e7}
    .btn{border:none;border-radius:var(--radius);padding:10px 16px;font-weight:700;cursor:pointer;font-family:inherit}
    #newBtn{background:var(--green);color:#fff;margin-bottom:20px}
    #clearHist{background:#eee;color:#333;margin-top:auto}

    /* Chat-wrapper */
    .chat-wrapper{flex:1;height:100%;background:#fff;display:flex;flex-direction:column;overflow:hidden;
      transition:margin-left .35s;box-shadow:var(--shadow)}
    #sidebar.open ~ .chat-wrapper{margin-left:280px}

    /* Header */
    .header{height:100px;background:var(--green);color:#fff;display:flex;align-items:center;justify-content:center;position:relative}
    .logo{width:70px;height:70px;position:absolute;right:32px;object-fit:contain}
    .header h1{font-size:1.75rem;font-weight:700;text-align:center;margin:0 110px 0 60px}
    #toggle{position:absolute;left:25px;width:32px;height:24px;background:none;border:none;cursor:pointer}
    #toggle span{display:block;height:3px;background:#fff;margin:5px 0}

    /* --- Nieuw: custom pill-toggle ---------------- */
    .lang-toggle{position:absolute;right:120px;top:50%;transform:translateY(-50%);
      background:rgba(255,255,255,.18);border-radius:999px;padding:4px;display:flex;gap:2px}
    .lang-btn{border:none;border-radius:999px;padding:6px 22px;font-size:.9rem;
      font-weight:700;font-family:inherit;cursor:pointer;background:none;color:#fff;
      transition:background .25s,color .25s}
    .lang-btn.active{background:#fff;color:var(--green-dark);box-shadow:0 2px 6px rgba(0,0,0,.15)}
    .lang-btn:hover:not(.active){background:rgba(255,255,255,.25)}

    /* Hero, suggestions, bubbles … (ongewijzigd) */
    .hero{text-align:center;padding:90px 48px 38px}
    .hero h2{font-size:2.05rem;font-weight:700;margin-bottom:10px}
    .hero p{font-size:1rem;color:#555}

    .suggestions{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;padding-bottom:48px;
      transition:opacity .35s,transform .35s}
    .suggestions.fade{opacity:0;transform:translateY(12px)}
    .suggestions button{border:1px solid var(--green);background:#fff;color:var(--green-dark);
      border-radius:50px;padding:10px 18px;font-size:.9rem;cursor:pointer;font-family:inherit;
      box-shadow:0 2px 6px rgba(0,0,0,.04);transition:all .25s}
    .suggestions button:hover{background:var(--green);color:#fff;box-shadow:0 4px 12px rgba(0,0,0,.08)}

    #chatlog{flex:1;overflow-y:auto;padding:32px 26px;border-top:1px solid #f0f0f0;
      display:flex;flex-direction:column;gap:18px;font-size:.96rem}
    .bubble{max-width:960px;width:fit-content;padding:14px 20px;border-radius:var(--radius);
      box-shadow:0 2px 8px rgba(0,0,0,.06);white-space:pre-wrap;line-height:1.45;opacity:0;transform:translateY(18px)}
    .bubble.in{animation:fadeSlide .45s forwards}@keyframes fadeSlide{to{opacity:1;transform:none}}
    .user{background:var(--green);color:#fff;margin-left:auto;transform:translate(30px,18px)}
    .user.in{animation:slideR .45s forwards}@keyframes slideR{to{opacity:1;transform:none}}
    .bot{background:#f7f7f7;transform:translate(-30px,18px)}
    .bot.in{animation:slideL .45s forwards}@keyframes slideL{to{opacity:1;transform:none}}

    .typing span{width:6px;height:6px;border-radius:50%;background:#888;display:inline-block;margin-right:4px;animation:pulse 1s infinite}
    .typing span:nth-child(2){animation-delay:.2s}.typing span:nth-child(3){animation-delay:.4s}
    @keyframes pulse{0%,80%,100%{opacity:.3}40%{opacity:1}}

    form{display:flex;gap:14px;padding:22px 24px;border-top:1px solid #ececec;background:#fafafa;box-shadow:inset 0 4px 6px rgba(0,0,0,.03)}
    input{flex:1;padding:14px 18px;border:1px solid #ccc;border-radius:var(--radius);font-family:inherit;font-size:1rem}
    form button{background:var(--green);color:#fff;border:none;border-radius:var(--radius);padding:14px 26px;font-size:1rem;cursor:pointer;font-family:inherit;transition:opacity .25s}
    form button:hover{opacity:.9}
  </style>
</head>
<body>

<!-- Sidebar -->
<div id="sidebar">
  <h2 id="histTitle">History</h2>
  <button id="newBtn" class="btn">New Chat</button>
  <div id="histList" style="flex:1;overflow-y:auto"></div>
  <button id="clearHist" class="btn">Clear History</button>
</div>

<!-- Chat -->
<div class="chat-wrapper">
  <div class="header">
    <button id="toggle"><span></span><span></span><span></span></button>
    <h1>EcoSage Chat</h1>

    <!-- custom pill toggle -->
    <div class="lang-toggle">
      <button class="lang-btn active" data-lang="en">EN</button>
      <button class="lang-btn" data-lang="nl">NL</button>
    </div>

    <img src="logo.png" class="logo" alt="logo">
  </div>

  <section id="hero" class="hero">
    <h2>What can I help with?</h2>
    <p>Ask anything about European energy &amp; climate policy.</p>
  </section>

  <div id="suggestions" class="suggestions"></div>
  <div id="chatlog"></div>

  <form id="chat-form" autocomplete="off">
    <input id="userInput" placeholder="Type your question…" required>
    <button id="sendBtn" type="submit">Send</button>
  </form>
</div>

<script>
/* Text resources */
const TEXT={en:{heroH2:"What can I help with?",heroP:"Ask anything about European energy & climate policy.",
                ph:"Type your question…",send:"Send",hist:"History",newChat:"New Chat",
                clear:"Clear History",noSess:"No sessions",
                ex:["Explain the EU Green Deal","Key points of Fit-for-55","Latest ETS regulations",
                    "Subsidies for solar panels","Impact of REPowerEU","What is the Just Transition Fund?",
                    "How does the CBAM work?","EU targets for renewable energy","Funding opportunities for hydrogen",
                    "Timeline of the Energy Efficiency Directive","Role of carbon pricing in aviation",
                    "Status of offshore wind in Europe","Difference between RED II and RED III",
                    "Criticism of EU taxonomy rules","Future of nuclear in EU climate policy"]},
           nl:{heroH2:"Waarmee kan ik je mee helpen?",heroP:"Stel al je vragen over Europees energie- & klimaatbeleid.",
                ph:"Typ je vraag…",send:"Versturen",hist:"Geschiedenis",newChat:"Nieuw gesprek",
                clear:"Geschiedenis wissen",noSess:"Geen sessies",
                ex:["Leg de Europese Green Deal uit","Belangrijkste punten van Fit-for-55","Laatste ETS-regels",
                    "Subsidies voor zonnepanelen","Impact van REPowerEU","Wat is het Just Transition Fund?",
                    "Hoe werkt de CBAM?","EU-doelen voor hernieuwbare energie","Financiering voor waterstof",
                    "Tijdlijn van de Energie-efficiëntierichtlijn","Rol van koolstofbeprijzing in de luchtvaart",
                    "Stand van offshore-wind in Europa","Verschil tussen RED II en RED III",
                    "Kritiek op EU-taxonomieregels","Toekomst van kernenergie in het EU-klimaatbeleid"]}};

const $=id=>document.getElementById(id),LS="ecoHist";
const sidebar=$("sidebar"),toggle=$("toggle"),chat=$("chatlog"),hero=$("hero"),sugg=$("suggestions"),
      inp=$("userInput"),form=$("chat-form"),sendBtn=$("sendBtn"),
      newBtn=$("newBtn"),clearBtn=$("clearHist"),histTitle=$("histTitle"),hist=$("histList"),
      langButtons=document.querySelectorAll(".lang-btn");

let lang="en",buf=[];

/* Language toggle */
langButtons.forEach(btn=>btn.onclick=()=>{
  langButtons.forEach(b=>b.classList.toggle("active",b===btn));
  lang=btn.dataset.lang;refreshUI();
});

/* UI refresh */
function refreshUI(){
  const t=TEXT[lang];
  hero.querySelector("h2").textContent=t.heroH2;
  hero.querySelector("p").textContent=t.heroP;
  inp.placeholder=t.ph;sendBtn.textContent=t.send;
  histTitle.textContent=t.hist;newBtn.textContent=t.newChat;clearBtn.textContent=t.clear;
  sugg.classList.add("fade");
  setTimeout(()=>{drawSug();sugg.classList.remove("fade")},350);
  list();
}

/* Suggestions chips */
function drawSug(){
  sugg.innerHTML="";
  const arr=[...TEXT[lang].ex];
  for(let i=0;i<5&&arr.length;i++){
    const txt=arr.splice(Math.random()*arr.length|0,1)[0];
    const b=document.createElement("button");b.textContent=txt;sugg.appendChild(b);
  }
}
drawSug(); /* initial */

/* Sidebar toggle */
toggle.onclick=()=>sidebar.classList.toggle("open");

/* bubble helpers */
const bubble=(txt,cls)=>{
  const d=document.createElement("div");d.className=`bubble ${cls}`;d.textContent=txt;
  chat.appendChild(d);requestAnimationFrame(()=>d.classList.add("in"));chat.scrollTop=chat.scrollHeight;
};
const typing=()=>{
  const d=document.createElement("div");d.className="bubble bot";
  d.innerHTML='<span class=\"typing\"><span></span><span></span><span></span></span>';
  chat.appendChild(d);requestAnimationFrame(()=>d.classList.add("in"));chat.scrollTop=chat.scrollHeight;return d;
};

/* History helpers */
const getH=()=>JSON.parse(localStorage.getItem(LS)||"[]");
const saveH=h=>localStorage.setItem(LS,JSON.stringify(h.slice(-20)));
const store=()=>{if(!buf.length)return;const h=getH();h.push({time:new Date().toLocaleString(),chat:buf});saveH(h);buf=[]};
const list=()=>{
  hist.innerHTML="";
  const h=getH();
  if(!h.length){hist.innerHTML=`<p style='font-size:.85rem;color:#666'>${TEXT[lang].noSess}</p>`;return;}
  h.slice().reverse().forEach(s=>{
    const div=document.createElement("div");div.className="session";div.textContent=s.time;div.onclick=()=>load(s);hist.appendChild(div);
  });
};
const load=s=>{sidebar.classList.remove("open");chat.innerHTML="";
  s.chat.forEach(m=>bubble(m.text,m.role));hero.style.display="none";sugg.style.display="none"};
list();

/* buttons */
newBtn.onclick=()=>{store();chat.innerHTML="";hero.style.display="block";sugg.style.display="flex";drawSug();inp.focus()};
clearBtn.onclick=()=>{localStorage.removeItem(LS);list()};

/* suggestion click */
sugg.onclick=e=>{if(e.target.tagName==="BUTTON"){inp.value=e.target.textContent;form.dispatchEvent(new Event("submit"))}};

/* form submit */
form.addEventListener("submit",async e=>{
  e.preventDefault();
  const msg=inp.value.trim();if(!msg)return;
  hero.style.display="none";sugg.style.display="none";
  bubble(msg,"user");buf.push({role:"user",text:msg});
  inp.value="";inp.focus();
  const wait=typing();
  try{
    const r=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:msg,lang})});
    const d=await r.json();
    wait.remove();bubble(d.reply,"bot");buf.push({role:"bot",text:d.reply});
  }catch{wait.remove();bubble("Something went wrong.","bot")}
});

/* save on unload */
window.addEventListener("beforeunload",store);
</script>
</body>
</html>